{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Cocoon","text":"<p>Welcome to my blog. You'll find writeups and ideas here.</p>"},{"location":"#paranoidmoth","title":"paranoidmoth","text":"<p>I'm Francisco Santos, 24 years old. I'm a pentester at Devoteam Cybertrust. I love listening to music and playing some video-games.</p> <p>The nickname <code>paranoidmoth</code> is a reference to radiohead (paranoid android) mixed with a word I like.</p> <p></p>"},{"location":"CVE%27s/CVE-2023-36829/","title":"CVE 2023-36829","text":"<p>This is a writeup for CVE 2023-36829. My first CVE.</p>"},{"location":"CVE%27s/CVE-2023-36829/#explanation","title":"Explanation","text":""},{"location":"CVE%27s/CVE-2023-36829/#cors","title":"CORS","text":"<p>Cross-Origin Resource Sharing is a browser mechanism that enables controlled access to resources outside a given domain.</p>"},{"location":"CVE%27s/CVE-2023-36829/#further-reading","title":"Further reading","text":"<p>https://portswigger.net/web-security/cors#what-is-cors-cross-origin-resource-sharing</p>"},{"location":"CVE%27s/CVE-2023-36829/#same-origin-policy","title":"Same-Origin Policy","text":"<p>The Same-Origin Policy is a mechanism that prevents domain A from carrying actions on domain B.</p>"},{"location":"CVE%27s/CVE-2023-36829/#further-reading_1","title":"Further reading","text":"<p>https://portswigger.net/web-security/cors/same-origin-policy</p>"},{"location":"CVE%27s/CVE-2023-36829/#sop-cors","title":"SOP + CORS","text":"<p>CORS specifies how SOP can be relaxed so domain A can carry actions on domain B.</p>"},{"location":"CVE%27s/CVE-2023-36829/#cors-headers","title":"CORS Headers","text":"<ul> <li>Access-Control-Allow-Origin</li> <li>Access-Control-Allow-Credentials</li> </ul> <p>The first response header specifies which domain A (or domains) are allowed to perform actions on domain B. The second response header specifies if that domain A is allowed to perform actions that require credentials on domain B.</p> <p>There are more headers but these are the most interesting for this CVE.</p> <p>Usually, the access-control-allow-origin header will parse the domain sent in the http request with the Origin header, and deduce if that origin is allowed or not.</p>"},{"location":"CVE%27s/CVE-2023-36829/#the-cve","title":"The CVE","text":"<p>The sentry.io CORS policy was to permissive: An attacker could force sentry.io to execute a cross-origin action that requires credentials by registering a domain ending in sentry.io. </p> <p>Eg: attacker-sentry.io</p>"},{"location":"CVE%27s/CVE-2023-36829/#testing-for-the-cve","title":"Testing for the CVE","text":"<p>After changing the Origin header of an http request to <code>test-sentry.io</code>, the http response included the <code>Access-Control-Allow-Credentials: true</code> http header. It was possible to execute actions with credentials from that domain to sentry.io.</p>"},{"location":"CVE%27s/CVE-2023-36829/#restrictions","title":"Restrictions","text":"<p>Most modern browsers include cross-site cookie blocking. This attack would require some type of browser configuration tampering that allows cross-site cookies.</p>"},{"location":"CVE%27s/CVE-2023-36829/#conclusion","title":"Conclusion","text":"<p>Testing for permisse CORS configurations is essential even with cross-site cookies blocked. Its possible a user utilizes a browser that allows those cookies, or an attacker can bypass the cross-site cookies restrictions itself.</p>"},{"location":"CVE%27s/CVE-2023-36829/#cwe","title":"CWE","text":"<p>CWE-942: Permissive Cross-domain Policy with Untrusted Domains </p>"},{"location":"CVE%27s/CVE-2023-36829/#cvss31","title":"CVSS3.1","text":"<p>CVSS:3.1/AV:N/AC:H/PR:N/UI:R/S:U/C:H/I:H/A:N</p>"},{"location":"CVE%27s/CVE-2023-36829/#sentryio-advisory","title":"Sentry.io advisory","text":"<p>https://github.com/getsentry/sentry/security/advisories/GHSA-4xqm-4p72-87h6</p>"},{"location":"writeups/","title":"Home","text":"<p>In this directory you will find my writeups for solved challenges.</p>"},{"location":"writeups/pentesterlab/CVE-2007-1860-Double-Encoding/","title":"Introduction","text":"<p>The following information explains how to solve the CVE-2007-1860 iso. It's a free pentesterlab exercise.</p>"},{"location":"writeups/pentesterlab/CVE-2007-1860-Double-Encoding/#the-problem-with-tomcat","title":"The problem with tomcat","text":"<p>Linux/Unix systems cannot execute <code>tomcat</code> on port <code>80</code> without root permissions. Tomcat does not drop privilleges at startup. For tomcat to be available for most users, it needs to execute on port <code>80</code> or <code>443</code> for https. This leads to a possible solution.</p>"},{"location":"writeups/pentesterlab/CVE-2007-1860-Double-Encoding/#proxying-from-apache-to-tomcat","title":"Proxying from apache to tomcat","text":"<p>To make the tomcat instance available for most users, an apache instance executes on port <code>80</code> and proxies the traffic to tomcat running at a higher port.</p> <p>These two instances can execute on the same server or not.</p> <p>The apache instance decides if the request should be proxied to tomcat or not.</p> <p>It's important to figure out which instance handles the <code>HTTP</code> request url. You can discover this by forcing <code>404</code> pages. If the <code>404</code> page belongs to apache, the component is apache. If it's a tomcat <code>404</code> page, the component is tomcat</p>"},{"location":"writeups/pentesterlab/CVE-2007-1860-Double-Encoding/#the-problem-of-proxying-from-apache-to-tomcat","title":"The problem of proxying from apache to tomcat","text":"<p>Both web-servers url-decode the path provided by the user. If you send <code>%252e</code> as input, the apache server will decode it to <code>%2e</code>. If the url accessed is configured to be proxied to tomcat, tomcat receives the request and url-decodes the <code>%2e</code> to <code>.</code>.</p> <p>With this information, we can access the tomcat manager. </p>"},{"location":"writeups/pentesterlab/CVE-2007-1860-Double-Encoding/#poc","title":"PoC","text":"<ol> <li>Find a tomcat 404 page.</li> <li>Use that page to send a request to tomcat that traverses to the manager.</li> </ol> <p>The tomcat 404 page can be found at: <code>/examples/jsp/</code>. </p> <p>The payload is: <code>https://vulnerable_host.com/examples/jsp/%252e%252e/%252e%252e/manager/html</code></p> <p>This http request forces the tomcat manager to traverse to <code>manager/html</code>. (Tomcat receives the request as <code>%2e</code> and decodes it to <code>.</code> before processing it).</p>"},{"location":"writeups/pentesterlab/CVE-2007-1860-Double-Encoding/#in-we-go","title":"In we go","text":"<p>This instance of tomcat uses the default credentials <code>admin:</code>. We can base64 encode this and send it as input through the <code>&lt;Authorization: Basic&gt;</code> HTTP header.</p> <p><code>Authorization: Basic YWRtaW46</code></p>"},{"location":"writeups/pentesterlab/CVE-2007-1860-Double-Encoding/#the-webshell","title":"The webshell","text":"<p>We can upload a <code>.war</code> file through the manager. There's a <code>war</code> webshell in github.</p> <p>We need to double-encode <code>..</code> again or we get a 404 page.</p>"},{"location":"writeups/pentesterlab/CVE-2007-1860-Double-Encoding/#poc_1","title":"PoC","text":"<p>Ensure the authorization header is set when issuing the requests</p> <ol> <li>Download the  <code>war</code> webshell from github</li> <li>Set intercept to on and deploy the <code>war</code> file. In BurpSuite, insert the following contents at the beggining of the path:     <code>/examples/jsp/%252e%252e/%252e%252e</code> (Should look like this: <code>/examples/jsp/%252e%252e/%252e%252e/manager/html/upload</code>)</li> <li>Access the webshell with the traversal trick: <code>/examples/jsp/%252e%252e/%252e%252e/&lt;webshell filename&gt;</code></li> </ol>"},{"location":"writeups/pentesterlab/CVE-2007-1860-Double-Encoding/#conclusion","title":"Conclusion","text":"<ul> <li>Double URL encoding can bypass restrictions if the payload is decoded twice (or recursively).</li> </ul>"},{"location":"writeups/pentesterlab/CVE-2007-1860-Double-Encoding/#concise-mindmap","title":"Concise Mindmap","text":""}]}